{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: BUSL-1.1
~}}

{{page-title "Variables"}}
<section class="section">
  <div class="toolbar">
    <div class="toolbar-item is-right-aligned is-mobile-full-width">
      <Hds::SegmentedGroup as |S|>
        {{#if this.namespaceOptions}}
          <S.Dropdown data-test-variable-namespace-filter as |dd|>
            <dd.ToggleButton @text="Namespace" @color="secondary" />
            {{#each this.namespaceOptions as |option|}}
              <dd.Radio
                name={{option.key}}
                {{on "change" (action this.setNamespace option.key)}}
                checked={{eq this.namespaceSelection option.key}}
              >
                {{option.label}}
              </dd.Radio>
            {{/each}}
          </S.Dropdown>
        {{/if}}

        {{#if (can "write variable" path="*" namespace=this.namespaceSelection)}}
          <S.Button
            @text="Create Variable"
            @icon="edit"
            @route="variables.new"
            data-test-create-var
            {{keyboard-shortcut
              pattern=(array "n" "v")
              action=(action this.goToNewVariable)
              label="Create Variable"
            }}
          />
        {{else}}
          <S.Button
            @text="Create Variable"
            @icon="edit"
            data-test-create-var
            disabled
          />
        {{/if}}
      </Hds::SegmentedGroup> 
    </div>
  </div>
  {{#if this.isForbidden}}
    <ForbiddenMessage />
  {{else}}
    {{#if this.hasVariables}}
      <VariablePaths
        @branch={{this.root}}
      />
    {{else}}
      <div class="empty-message">
        {{#if (eq this.namespaceSelection "*")}}
          <h3 data-test-empty-variables-list-headline class="empty-message-headline">
            No Variables
          </h3>
          {{#if (can "write variable" path="*" namespace=this.namespaceSelection)}}
            <p class="empty-message-body">
              Get started by <LinkTo @route="variables.new">creating a new variable</LinkTo>
            </p>
          {{/if}}
        {{else}}
          <h3 data-test-no-matching-variables-list-headline class="empty-message-headline">
            No Matches
          </h3>
          <p class="empty-message-body">
            No paths or variables match the namespace
            <strong>
              {{this.namespaceSelection}}
            </strong>
          </p>
        {{/if}}
      </div>
    {{/if}}
  {{/if}}
</section>
