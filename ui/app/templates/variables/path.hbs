{{!
  Copyright (c) HashiCorp, Inc.
  SPDX-License-Identifier: BUSL-1.1
~}}

{{page-title "Variables: " this.absolutePath}}
{{#each this.breadcrumbs as |crumb|}}
  <Breadcrumb @crumb={{crumb}} />
{{/each}}
  <section class="section">
    <div class="toolbar">
      <div class="toolbar-item is-right-aligned is-mobile-full-width">
      <Hds::SegmentedGroup as |S|>
        {{#if this.namespaceOptions}}
        <S.Dropdown data-test-variable-namespace-filter as |dd|>
          <dd.ToggleButton @text="Namespace" @color="secondary" />
          {{#each this.namespaceOptions as |option|}}
            <dd.Radio
              name={{option.key}}
              {{on "change" (action this.setNamespace option.key)}}
              checked={{eq this.namespaceSelection option.key}}
            >
              {{option.label}}
            </dd.Radio>
          {{/each}}
        </S.Dropdown>
        {{/if}}        

        {{#if (can "write variable" path=(concat this.absolutePath "/") namespace=this.namespaceSelection)}}
          <S.Generic>
            <span
              {{keyboard-shortcut
                pattern=(array "n" "v")
                action=(action this.goToNewVariable)
                label="Create Variable"
              }}
            />
          </S.Generic>
          <S.Button
            @text="Create Variable"
            @icon="edit"
            @route="variables.new"
            @query={{hash path=(concat this.absolutePath "/")}}
          />
        {{else}}
          <S.Button
            @text="Create Variable"
            @icon="edit"
            data-test-create-var
            disabled
          />
        {{/if}}
      </Hds::SegmentedGroup>
      </div>
    </div>
    {{#if this.isForbidden}}
      <ForbiddenMessage />
    {{else}}
      {{#if this.model.treeAtPath}}
        <VariablePaths
          @branch={{this.model.treeAtPath}}
        />
      {{else}}
        <div class="empty-message">
          {{#if (eq this.namespaceSelection "*")}}
            <h3 data-test-empty-variables-list-headline class="empty-message-headline">
              Path /{{this.absolutePath}} contains no variables
            </h3>
            <p class="empty-message-body">
              To get started, <LinkTo @route="variables.new" @query={{hash path=(concat this.absolutePath "/")}}>create a new variable here</LinkTo>, or <LinkTo @route="variables">go back to the Variables root directory</LinkTo>.
            </p>
          {{else}}
            <h3 data-test-no-matching-variables-list-headline class="empty-message-headline">
              No Matches
            </h3>
            <p class="empty-message-body">
              No paths or variables match the namespace 
              <strong>
                {{this.namespaceSelection}}
              </strong>
            </p>
          {{/if}}
        </div>
      {{/if}}
    {{/if}}
  </section>
